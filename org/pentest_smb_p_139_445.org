:PROPERTIES:
:ID:       ee7b0e9a-cb6d-434f-bf7d-87bbd00b18b9
:END:
#+title: Pentest - SMB p 139,445
#+filetags: :crackmapexec:smbmap:smb:pentest:
#+hugo_base_dir:../


[[https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb][HackTricks]]


* Port 139 [[id:2e735517-eea9-4a23-a83a-c99740b91756][NetBIOS]]
_NetBIOS_ is ~Network Basic Input Output System~, which is a software protocol that allows applications, PCs, and Desktops on a local area network (LAN) to communicate with network hardware and to transmit data across the network.
* Port 445 [[id:c761907f-f7ef-4aa7-adcf-e3d178feec86][SMB - Server Message Block]]
While Port 139 is known technically as ‘NBT over IP’, Port 445 is ‘SMB over IP’. SMB stands for ‘Server Message Blocks’.
** SMB
Server Message Block (SMB) is a client-server protocol that regulates access to files and entire directories and other network resources such as printers, routers, or interfaces released for the network.
* Server Enumeration
Search for hosts:
#+begin_src shell -n
nbtscan -r 192.168.1.1/24
#+end_src
** SMB information
#+begin_src shell -n
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>

# connect to rpc
rpcclient -U "" -N <IP> #No creds
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
rpcclient -U "username%passwd" <IP> #With creds
#+end_src

# smbclient
smbclient -L ////10.10.10.10///
smbclient //10.10.10.10/Public


See also impacket: samrdump, rpcdump
** Users, Groups
#+begin_src shell -n
crackmapexec smb 10.10.10.10 --users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups --loggedon-users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 -u usernames.txt -p ‘’ --continue-on-success


ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "

rpcclient -U "" -N 10.10.10.10
enumdomusers
enumdomgroups
#+end_src
