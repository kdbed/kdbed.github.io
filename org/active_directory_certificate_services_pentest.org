:PROPERTIES:
:ID:       88668f82-ad94-481f-9466-de6691494de2
:END:
#+title: #+title: Pentest - Active Directory - Certificate Services
#+filetags: :cert:activeDirectory:pentest:
#+hugo_base_dir:../


* Active Directory Certificate Services
[[https://social.technet.microsoft.com/wiki/contents/articles/3063.certutil-examples-for-managing-active-directory-certificate-services-ad-cs-from-the-command-line.aspx][social.technet.microsoft.com]]

Active Directory Certificate Services (AD CS) is an Active Directory server role which allows users to build PKI (Public Key Infrastructure). This can provide practical solutions for VPN access, SSL/TLS certificates and smart card logons, amongst other similar ubiquitous technologies you are likely to encounter on a daily basis. [[https://medium.com/@shaunwhorton/active-directory-certificate-services-domain-dominance-9ba2c54988d7][medium - shaun whorton]]




* Abusing misconfigured certificate templates

Use =Certify.exe= to enumerate Certificate Services [[https://github.com/GhostPack/Certify][GhostPack/Certify]]

#+begin_src sh
PS C:\ > .\Certify.exe find /vulnerable
#+end_src

#+ATTR_ORG: :width 1200
[[../static/images/certify1.png]]


Here's an example of a vulnerable cert template, which is used for client authentication.  Domain Users have enrollments rights, and they're also permitted to supply the subject (msPKI-Certificate-Name-Flag : ENROLLEE_SUPPLIES_SUBJECT)

#+ATTR_ORG :width 1200
[[../static/images/certify2.png]]





[[https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf][specterops - certified pre-owned]]
