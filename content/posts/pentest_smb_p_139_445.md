+++
title = "Pentest - SMB p 139,445"
author = ["kdb"]
tags = ["crackmapexec", "smbmap", "smb", "pentest"]
draft = false
+++

[HackTricks](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smb)


## Port 139 [NetBIOS]({{< relref "netbios.md" >}}) {#port-139-netbios--netbios-dot-md}

<span class="underline">NetBIOS</span> is `Network Basic Input Output System`, which is a software protocol that allows applications, PCs, and Desktops on a local area network (LAN) to communicate with network hardware and to transmit data across the network.


## Port 445 [SMB - Server Message Block]({{< relref "smb_server_message_block.md" >}}) {#port-445-smb-server-message-block--smb-server-message-block-dot-md}

While Port 139 is known technically as ‘NBT over IP’, Port 445 is ‘SMB over IP’. SMB stands for ‘Server Message Blocks’.


### SMB {#smb}

Server Message Block (SMB) is a client-server protocol that regulates access to files and entire directories and other network resources such as printers, routers, or interfaces released for the network.


## Server Enumeration {#server-enumeration}

Search for hosts:

```shell { linenos=true, linenostart=1 }
nbtscan -r 192.168.1.1/24
```


### SMB information {#smb-information}

```shell { linenos=true, linenostart=1 }
enum4linux -a [-u "<username>" -p "<passwd>"] <IP>
enum4linux-ng -A [-u "<username>" -p "<passwd>"] <IP>

# connect to rpc
rpcclient -U "" -N <IP> #No creds
rpcclient //machine.htb -U domain.local/USERNAME%754d87d42adabcca32bdb34a876cbffb  --pw-nt-hash
rpcclient -U "username%passwd" <IP> #With creds
```

smbclient -L __//10.10.10.10__

See also impacket: samrdump, rpcdump


### Users, Groups {#users-groups}

```shell { linenos=true, linenostart=1 }
crackmapexec smb 10.10.10.10 --users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 --groups --loggedon-users [-u <username> -p <password>]
crackmapexec smb 10.10.10.10 -u usernames.txt -p ‘’ --continue-on-success


ldapsearch -x -b "DC=DOMAIN_NAME,DC=LOCAL" -s sub "(&(objectclass=user))" -h 10.10.10.10 | grep -i samaccountname: | cut -f 2 -d " "

rpcclient -U "" -N 10.10.10.10
enumdomusers
enumdomgroups
```
