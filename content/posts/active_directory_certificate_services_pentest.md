+++
title = "#+title: Pentest - Active Directory - Certificate Services"
author = ["kdb"]
tags = ["cert", "activeDirectory", "pentest"]
draft = false
+++

## Active Directory Certificate Services {#active-directory-certificate-services}

[social.technet.microsoft.com](https://social.technet.microsoft.com/wiki/contents/articles/3063.certutil-examples-for-managing-active-directory-certificate-services-ad-cs-from-the-command-line.aspx)

Active Directory Certificate Services (AD CS) is an Active Directory server role which allows users to build PKI (Public Key Infrastructure). This can provide practical solutions for VPN access, SSL/TLS certificates and smart card logons, amongst other similar ubiquitous technologies you are likely to encounter on a daily basis. [medium - shaun whorton](https://medium.com/@shaunwhorton/active-directory-certificate-services-domain-dominance-9ba2c54988d7)


## Abusing misconfigured certificate templates {#abusing-misconfigured-certificate-templates}

Use `Certify.exe` to enumerate Certificate Services [GhostPack/Certify](https://github.com/GhostPack/Certify)

```sh
PS C:\ > .\Certify.exe find /vulnerable
```

{{< figure src="/images/certify1.png" >}}

Here's an example of a vulnerable cert template, which is used for client authentication.  Domain Users have enrollments rights, and they're also permitted to supply the subject (msPKI-Certificate-Name-Flag : ENROLLEE_SUPPLIES_SUBJECT)

\#+ATTR_ORG :width 1200
![](/images/certify2.png)

[specterops - certified pre-owned](https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf)
