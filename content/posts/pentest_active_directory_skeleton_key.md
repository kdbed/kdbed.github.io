+++
title = "Skeleton Key"
author = ["svejk"]
tags = ["kerberos", "activeDirectory", "windowsExploitation", "pentest"]
draft = false
+++

## Skeleton Key {#skeleton-key}

A ****Skeleton Key**** is a stealthy backdoor attack where Mimikatz injects a patch into ****LSASS memory**** on a Domain Controller. This allows an attacker to ****authenticate as any domain user using a master password****, in addition to their real credentials.


### Overview {#overview}

-   Injects code into \`lsass.exe\` on a Domain Controller
-   Leaves legitimate logins untouched
-   Adds a universal password valid for all domain accounts
-   Memory-resident: disappears on reboot


### Prerequisites {#prerequisites}

-   SYSTEM-level access on a ****Domain Controller****
-   Ability to execute code and patch LSASS memory
-   Mimikatz or similar tool


### Key Concepts {#key-concepts}

-   **LSASS**: Local Security Authority Subsystem Service; handles authentication
-   **Patch**: Modifies Kerberos/NTLM authentication providers in memory
-   **Backdoor password**: An additional universal password accepted for all users


### Mimikatz Commands {#mimikatz-commands}


#### Load Skeleton Key Patch {#load-skeleton-key-patch}

```powershell
mimikatz # privilege::debug
mimikatz # misc::skeleton
```

Default password: mimikatz

Once injected, **any** domain user can authenticate with either:

-   Their real password
-   The skeleton key password: \`mimikatz\`


#### Test Authentication {#test-authentication}

From any domain-joined machine:

```powershell
runas /user:corp.local\jdoe cmd
# Enter password: mimikatz
```

A shell should open, authenticating as \`jdoe\`.


### Limitations {#limitations}

-   Only works with ****NTLM**** and ****Kerberos TGTs issued by the patched DC****
-   Only works while the DC is running (cleared on reboot)
-   Does not persist unless reloaded or installed via persistent malware


### Impact {#impact}

-   Full domain compromise
-   Extremely stealthy â€“ no password changes, no account creation
-   Invisible to domain logs unless memory or behavior is being monitored


### Detection {#detection}

-   Monitor LSASS for code injection or unsigned module loads
-   Behavioral indicators:
    -   Unusual NTLM/Kerberos logons without known credentials
    -   Multiple users authenticating with the same password
-   Defender for Identity, EDRs like CrowdStrike, Sysmon for \`lsass.exe\` memory anomalies


### Mitigation {#mitigation}

-   Reboot the DC (clears the patch)
-   Use Protected Process Light (PPL) for LSASS (Windows Defender Credential Guard)
-   Monitor with EDR
-   Block admin rights to DCs and restrict RDP access
-   Isolate and rebuild compromised DCs


### References {#references}

-   <https://adsecurity.org/?p=1277>
-   <https://blog.cylance.com/skeleton-key-malware-authenticating-any-user-with-a-password-of-your-choice>
-   <https://github.com/gentilkiwi/mimikatz/wiki/module-~-misc>

[hacktricks](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/skeleton-key)

[netwrix](https://blog.netwrix.com/2022/11/29/skeleton-key-attack-active-directory/)
